dist: trusty
sudo: required
language: node_js
node_js:
  - 10 

addons:
  chrome: stable

services:
  - xvfb
  - postgresql

env:
  global:
    - PGUSER=postgres
    - PGPORT=5432

cache:
  directories:
  - node_modules

before_script:
  - psql -c 'create database rcdatadb;' -U $PGUSER
  - psql --dbname=$rcdatadb --file=db/db.sql
  #- psql -c 'create table users (id serial PRIMARY KEY, username VARCHAR (50) UNIQUE NOT NULL, password VARCHAR (50) NOT NULL);' -U $PGUSER
  - psql -c "CREATE USER user1 WITH PASSWORD 'password';" -U $PGUSER
  - psql -c "GRANT ALL PRIVILEGES ON DATABASE rcdatadb TO user1;" -U $PGUSER
  #- psql -c "INSERT INTO users (username,password) VALUES ('user1','password');" -U $PGUSER
  #- bash script.sh
  - "export DISPLAY=:99.0"
  - "sh -e /etc/init.d/xvfb start"
  - sleep 5
  - jdk_switcher use oraclejdk8
  - npm install
  - npm install --only=dev
  - npm install -g chromedriver forever
  - mv .env.test .env 
  - cat .env
  - npm run start &
  - sleep 30

script:
  - npm run test
